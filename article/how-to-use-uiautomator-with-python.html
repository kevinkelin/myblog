<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#33363b">
    <meta name="msapplication-TileColor" content="#33363b">
    
    
    
    <meta name="keywords" content="python, 自动化测试, tornado, webpy, 微信公众号">
    
    
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
    
    
    <link rel="icon" type="image/png" sizes="192x192" href="/favicons.ico">
    
    
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
    
    
    <link rel="mask-icon" href="/favicons.svg" color="#33363b">
    
    
    <link rel="manifest" href="/favicons/site.webmanifest">
    
    
    <meta name="msapplication-config" content="/favicons/browserconfig.xml">
    
    
    <link rel="alternate" href="/atom.xml" title="杨彦星" type="application/atom+xml" />
    
    <link rel="stylesheet" type="text/css" href="/css/index.css">
    
    <link rel="stylesheet" type="text/css" href="/css/sidebar.css">
    
    
<link rel="stylesheet" type="text/css" href="/css/page.css">
<link rel="stylesheet" type="text/css" href="/css/post.css">

    
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/css/[object Object].css">
    <link rel="stylesheet" type="text/css" href="/css/lightgallery.min.css">
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <link rel="stylesheet" type="text/css" href="/js/google-code-prettify/prettify.css">
    
    <script defer type="text/javascript" src="/js/util.js"></script>
    <script defer type="text/javascript" src="/js/scrollspy.js"></script>
    <script defer type="text/javascript" src="/js/fontawesome-all.min.js"></script>
    <script defer type="text/javascript" src="/js/lightgallery.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-fullscreen.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-hash.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-pager.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-thumbnail.min.js"></script>
    <script defer type="text/javascript" src="/js/lg-zoom.min.js"></script>
    
    
    <script defer type="text/javascript" src="/js/search.js"></script>
    <script type="text/javascript" src="/js/google-code-prettify/prettify.js"></script>
    <script type="text/javascript">    
    $(document).ready(function () {
      var searchPath = "search.xml";
      if (searchPath.length === 0) {
        searchPath = "search.xml";
      }
      var path = "/" + searchPath;
      searchFunc(path, "search-input", "search-result");
      
      $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
      prettyPrint();
    });
    </script>
    
    
    <script defer type="text/javascript" src="/js/index.js"></script>
    
    <script defer type="text/javascript" src="/js/custom.js"></script>
    <title>使用uiautomator的python封装进行android的UI测试 | 杨彦星 - 序语程言</title>
  </head>
  <body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"  data-spy="scroll" data-target=".list-group">
    
<header id="header" class="header">
  <div class="container">
    <div class="header-container">
      <div class="header-title">
        <h1 class="title"><a href="/">杨彦星</a></h1>
        <h2 class="subtitle">序语程言</h2>
      </div>
      
    </div>
    
<nav id="nav" class="nav">
  <a id="nav-toggle" class="nav-toggle"><i class="fas fa-bars"></i></a>
  <ul id="menu">
    
    <li><a href="/.">首页</a></li>
    
    <li><a href="/archives">归档</a></li>
    
    <li><a href="/categories">分类</a></li>
    
    <li><a href="/tags">标签</a></li>
    
    <li><a href="http://yangyanxing.lofter.com">时光</a></li>
    
    <li><a href="/about">关于</a></li>
    
  </ul>
</nav>


  </div>
</header>


    <main id="main" class="main">
      <div class="container">
        <div class="main-container">
          <div class="content">
            
<section id="post" class="post">
  
  <article class="post-container card " itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="http://www.yangyanxing.com/article/how-to-use-uiautomator-with-python.html">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
       <meta itemprop="name" content="杨彦星">
       <meta itemprop="description" content="人一切的痛苦，本质是都是对自已的无能的愤怒">
       <meta itemprop="image" content="/images/1.jpg">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
       <meta itemprop="name" content="杨彦星">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
       <span class="">使用uiautomator的python封装进行android的UI测试</span>
      </h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i> <time title="post-date" itemprop="dateCreated datePublished" datetime="2015-08-28T01:17:30+08:00">2015-08-28</time>
        </span>
        
        
        
        <span class="post-meta-divider"> | </span>
        
        <span class="post-categories">
          <i class="far fa-folder-open"></i>
          
          
          <span itemprop="about" itemscope itemtype="http://schema.org/Thing"> <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a></span>
          
          
        </span>
        
        
      </div>
    </header>
    <main class="post-body" itemprop="articleBody">
      <p>最近项目中有个需求要在至少100台手机上对应用进行兼容性测试，首先想到的就是自动化来操作，不想一台台的操作相同的重复操作</p>
<p>基本的需求是这样的，安装被测试的应用，启动并退出，然后安装测试样本，检测是否有相应的弹窗拦截</p>
<p>考虑到市面上的各种测试框架与自已熟悉的编程语言，最后选择了google自家的uiautomator来搞，借助于前人对其进行了python封装，所以一开始还是挺顺利的，但是整个过程中还是有很多需要注意的地方<br> <a id="more"></a><br><a href="https://github.com/xiaocong/uiautomator" title="https://github.com/xiaocong/uiautomator" target="_blank" rel="noopener">https://github.com/xiaocong/uiautomator</a>   这个是xiaocong对其进行的python封装，也是这个小测试用例使用的，膜拜下</p>
<h1 id="准备："><a href="#准备：" class="headerlink" title="准备："></a>准备：</h1><p>python27,不能使用python26，安装urllib3与uiautomator，可以使用easy_install命令，安装android SDK，配置好adb的环境变量，这些应该都是作为android测试人员最基本的环境配置，要测试的应用是360手机急救箱，可以从<a href="http://jijiu.360.cn/" title="http://jijiu.360.cn/" target="_blank" rel="noopener">http://jijiu.360.cn/</a> 这个网址下载</p>
<p>下面是基本的测试流程</p>
<pre><code class="python">
# 需要配置好adb 环境变量
# 1.先确定有几台手机
# 2.再确定有多少个应用
# 3.先安装mkiller,启动mkiller
# 4.再安装测试的样本
# 5.检查是否有取消安装的按钮出现，出现说明测试通过，没出现说明测试失败
</code></pre>
<p>既然要采用自动化，就不能手机测试那样，一台一台的跑，应该可以同时跑多台手机，我的想法就是启用多线程来跑，每个手机用一个线程来跑</p>
<h1 id="确定有几台手机"><a href="#确定有几台手机" class="headerlink" title="确定有几台手机"></a>确定有几台手机</h1><p>我封了一个方法</p>
<pre><code class="python">
def finddevices():
    rst = util.exccmd(&#39;adb devices&#39;)
    devices = re.findall(r&#39;(.*?)\s+device&#39;,rst)
    if len(devices) &gt;1:
        deviceIds = devices[1:]
        logger.info(&#39;共找到%s个手机&#39;%str(len(devices)-1))
        for i in deviceIds:            
            logger.info(&#39;ID为%s&#39;%i)
        return deviceIds
    else:
        logger.error(&#39;没有找到手机，请检查&#39;)
        return
</code></pre>
<h1 id="uiautomator在python中的使用"><a href="#uiautomator在python中的使用" class="headerlink" title="uiautomator在python中的使用"></a>uiautomator在python中的使用</h1><p>下面来说说uiautomator在python中的使用，其实github中的readme.md写的挺清楚，但是实践起来还是有一些问题</p>
<p>uiautomator在使用的时候都要初始化一个d对象，单个手机可以通过</p>
<pre><code class="python">from uiautomator import device as d
</code></pre>
<p>多台手机可以</p>
<pre><code class="python">from uiautomator import Device
</code></pre>
<p>然后通过 d=Device(Serial)的方式初始化d对象，以后的操作基本上都是操作这个d对象，可以想象每个d对应着一台手机</p>
<p>我觉得这个设计有点不大好，我现在还经常在device的大小写上犯迷糊</p>
<h1 id="基本的点击操作"><a href="#基本的点击操作" class="headerlink" title="基本的点击操作"></a>基本的点击操作</h1><pre><code class="python"># press home key
d.press.home()
# press back key
d.press.back()
# the normal way to press back key
d.press(&quot;back&quot;)
# press keycode 0x07(&#39;0&#39;) with META ALT(0x02) on
d.press(0x07, 0x02)
</code></pre>
<p>首先安装启动应用，安装采用adb install 命令，启动采用adb shell am start 命令</p>
<p>手机急救箱的launchable-activity是’com.qihoo.mkiller.ui.index.AppEnterActivity’,第一次启动会弹出使用协议要用户来点击”同意并使用”</p>
<p><a href="/image/2015/08/dump_3164510212585030182.png"><img src="/image/2015/08/dump_3164510212585030182_thumb.png" alt="dump_3164510212585030182" title="dump_3164510212585030182"></a></p>
<h1 id="watcher的使用"><a href="#watcher的使用" class="headerlink" title="watcher的使用"></a>watcher的使用</h1><p>我这里采用了watcher来监视并且点击，基本的watcher方法是</p>
<pre><code class="python">d.watcher(&#39;agree&#39;).when(text=u&#39;同意并使用&#39;).click(text=u&#39;同意并使用&#39;)
</code></pre>
<p>先给watcher起一个名字，随便起，我这里叫agree，when里面写条件，我这里就是当text为’同意并使用’,后面写当符合这些条件的时候进行的操作，我这里就是click(text=u’同意并使用’),这里有一个坑，我之前写watcher的时候，就直接写click() 我以为里面不写内容默认就会点击前面找到的元素，但是后来发现这样是不行的，必须要写上要点击哪个对象</p>
<p>其实对于这种只出现一次的view可以不用写在watcher里，可以直接写d(text=u’同意并使用’).click(),但是考虑到这个界面出现之前会有一些延迟，各种手机的性能不同，也不好加time.sleep()时间，所以我建议像这种一律写到watcher里，什么时候出现就什么时候点击。</p>
<p>由于这个应用会请求root权限，所以有时第三方的root工具会弹相应的授权提示框，我想大部分的root工具应该都是有”允许”这个按钮的，于是我就加了一个watcher</p>
<pre><code class="python">d.watcher(&#39;allowroot&#39;).when(text=u&#39;允许&#39;).click(text=u&#39;允许&#39;)
</code></pre>
<p>点击同意后会再弹一个开启超强模式的弹框，这里我要点击的是取消</p>
<p><a href="/image/2015/08/dump_3893862848196469772.png"><img src="/image/2015/08/dump_3893862848196469772_thumb.png" alt="dump_3893862848196469772" title="dump_3893862848196469772"></a></p>
<pre><code class="python">d.watcher(&#39;cancel&#39;).when(text=u&#39;取消&#39;).click(text=u&#39;取消&#39;)
</code></pre>
<p>之后要点击一下back键，这时又会弹一个是否退出的框，这次我要点击“确认”</p>
<p><a href="/image/2015/08/dump_8250787869838979823.png"><img src="/image/2015/08/dump_8250787869838979823_thumb.png" alt="dump_8250787869838979823" title="dump_8250787869838979823"></a></p>
<p>这个确认我是后面单独处理的，其实也可以放在watcher里，只是我的考虑是有时点击back键的时候不一定会弹出来这个框，所以我会尝试多点击几次，直到这个框出来</p>
<p>但现在就有一个问题了，刚才写了一个d.watcher(‘cancel’).when(text=u’取消’).click(text=u’取消’)，这时当弹出这个框的时候，watcher就要起作用了，就会先去点击取消，这不是我想要的，所以我将之前点击取消的加了一个限制条件</p>
<pre><code class="python">d.watcher(&#39;cancel&#39;).when(text=u&#39;取消&#39;).when(textContains=u&#39;超强防护能够极大提高&#39;).click(text=u&#39;取消&#39;)
</code></pre>
<p>textContains的意思就是和包含里面的文字，上面的意思就是当界面中text是“取消”的同时还要有一个view的text中要包含u’超强防护能够极大提高’,这样的话就限制的点击“取消”的条件，再遇到退出时的提示框就不会再会点击”取消”了</p>
<p>尽可能的想到可能出现的弹框，比较在小米手机中安装应用会弹一个小米的安装确认界面，使用下面的watcher来进行监测点击</p>
<pre><code class="python">d.watcher(&#39;install&#39;).when(text=u&#39;安装&#39;).when(textContains=u&#39;是否要安装该应用程序&#39;).click(text=u&#39;安装&#39;,className=&#39;android.widget.Button&#39;)
</code></pre>
<p>总的watcher就是下面的样子</p>
<pre><code class="python">d.watcher(&#39;allowroot&#39;).when(text=u&#39;允许&#39;).click(text=u&#39;允许&#39;)
        d.watcher(&#39;install&#39;).when(text=u&#39;安装&#39;).when(textContains=u&#39;是否要安装该应用程序&#39;).click(text=u&#39;安装&#39;,className=&#39;android.widget.Button&#39;) #专门为小米弹出的安装拦截
        d.watcher(&#39;cancel&#39;).when(text=u&#39;取消&#39;).when(textContains=u&#39;超强防护能够极大提高&#39;).click(text=u&#39;取消&#39;)
        d.watcher(&#39;confirm&#39;).when(text=u&#39;确认&#39;).when(textContains=u&#39;应用程序许可&#39;).click(text=u&#39;确认&#39;)
        d.watcher(&#39;agree&#39;).when(text=u&#39;同意并使用&#39;).click(text=u&#39;同意并使用&#39;)
        d.watcher(&#39;weishiuninstall&#39;).when(textContains=u&#39;暂不处理&#39;).click(textContains=u&#39;暂不处理&#39;)
</code></pre>
<p>然后使用d.watchers.run()来启动watcher</p>
<p>但是在实际的watcher中，我发现这个watcher并没有想象的那样好用，有时经常是明明有相应的view但是就是点击不上，经过多次尝试，我发现，当界面已经出现的时候，这时我再强行的使用run()方法来启动watchers，这时它就能很好的点击了，所以基于此，我写了一个循环来来无限的调用run方法，times限制了次数，根据项目的实际进行调整吧，sleep时间也可以相应的调整</p>
<pre><code class="python">def runwatch(d,data):
    times = 120
    while True:
        if data == 1:                
            return True
        # d.watchers.reset()
        d.watchers.run()        
        times -= 1
        if times == 0:
            break
        else:
            time.sleep(0.5)
</code></pre>
<p>监视的时候又不能只跑监视程序，还要跑相应的测试步骤，所以这里我把这个runwatch方法放到一个线程中去跑，起一个线程用作监视，脚本的测试方法放在另外的线程上跑</p>
<p>线程函数</p>
<pre><code class="python">#线程函数
class FuncThread(threading.Thread):
    def __init__(self, func, *params, **paramMap):
        threading.Thread.__init__(self)
        self.func = func
        self.params = params
        self.paramMap = paramMap
        self.rst = None
        self.finished = False

    def run(self):
        self.rst = self.func(*self.params, **self.paramMap)
        self.finished = True

    def getResult(self):
        return self.rst

    def isFinished(self):
        return self.finished

def doInThread(func, *params, **paramMap):
    t_setDaemon = None
    if &#39;t_setDaemon&#39; in paramMap:
        t_setDaemon = paramMap[&#39;t_setDaemon&#39;]
        del paramMap[&#39;t_setDaemon&#39;]
    ft = FuncThread(func, *params, **paramMap)
    if t_setDaemon != None:
        ft.setDaemon(t_setDaemon)
    ft.start()
    return ft
</code></pre>
<p>所以这里启动线程来跑runwatcher的调用就是</p>
<p>data = 0</p>
<p>doInThread(runwatch,d,data,t_setDaemon=True)</p>
<h1 id="多台手机的运行问题"><a href="#多台手机的运行问题" class="headerlink" title="多台手机的运行问题"></a>多台手机的运行问题</h1><p>基本的思路就是这样，这样当脚本都写完了以后在单个手机上运行很好，但是一旦插入多个手机就会出现一个问题，所有watcher只在一台手机上有效，另外的手机就只能傻傻的不知道点击，这个问题困扰了很久，我在github上也给作者发issue，但是后来我自已找到了解决的办法，就是在d=Device(Serial)的时候加上local_port端口号，让每台手机使用不同的local_port端口号，这样各自运行各自的，都很完好</p>
<h1 id="最终的代码"><a href="#最终的代码" class="headerlink" title="最终的代码"></a>最终的代码</h1><p>以下了测试脚本的代码</p>
<p>mkiller.py,主测试脚本文件</p>
<pre><code class="python">#coding:gbk

import os,sys,time,re,csv
import log
import util
from uiautomator import Device
import traceback
import log,logging
import multiprocessing

optpath = os.getcwd()                      #获取当前操作目录
imgpath = os.path.join(optpath,&#39;img&#39;)      #截图目录

def cleanEnv():
    os.system(&#39;adb kill-server&#39;)
    needClean = [&#39;log.log&#39;,&#39;img&#39;,&#39;rst&#39;]
    pwd = os.getcwd()
    for i in needClean:
        delpath = os.path.join(pwd,i)
        if os.path.isfile(delpath):
            cmd = &#39;del /f/s/q &quot;%s&quot;&#39;% delpath
            os.system(cmd)
        elif os.path.isdir(delpath):
            cmd = &#39;rd /s/q &quot;%s&quot;&#39; %delpath
            os.system(cmd)
    if not os.path.isdir(&#39;rst&#39;):
        os.mkdir(&#39;rst&#39;)

def runwatch(d,data):
    times = 120
    while True:
        if data == 1:                
            return True
        # d.watchers.reset()
        d.watchers.run()        
        times -= 1
        if times == 0:
            break
        else:
            time.sleep(0.5)

def installapk(apklist,d,device):
    sucapp = []
    errapp = []
    # d = Device(device)
    #初始化一个结果文件
    d.screen.on()
    rstlogger = log.Logger(&#39;rst/%s.log&#39;%device,clevel = logging.DEBUG,Flevel = logging.INFO)
    #先安装mkiller
    mkillerpath = os.path.join(os.getcwd(),&#39;MKiller_1001.apk&#39;)
    cmd = &#39;adb -s %s install -r %s&#39;% (device,mkillerpath)
    util.exccmd(cmd)
    def checkcancel(d,sucapp,errapp):
        times = 10
        while(times):
            if d(textContains = u&#39;取消安装&#39;).count:
                print d(textContains = u&#39;取消安装&#39;,className=&#39;android.widget.Button&#39;).info[&#39;text&#39;]
                d(textContains = u&#39;取消安装&#39;,className=&#39;android.widget.Button&#39;).click()
                rstlogger.info(device+&#39;测试成功，有弹出取消安装对话框&#39;)
                break
            else:
                time.sleep(1)
                times -= 1
                if times == 0:
                    rstlogger.error(device+&#39;测试失败，没有弹出取消安装对话框&#39;)
    try:        
        d.watcher(&#39;allowroot&#39;).when(text=u&#39;允许&#39;).click(text=u&#39;允许&#39;)
        d.watcher(&#39;install&#39;).when(text=u&#39;安装&#39;).when(textContains=u&#39;是否要安装该应用程序&#39;).click(text=u&#39;安装&#39;,className=&#39;android.widget.Button&#39;) #专门为小米弹出的安装拦截
        d.watcher(&#39;cancel&#39;).when(text=u&#39;取消&#39;).when(textContains=u&#39;超强防护能够极大提高&#39;).click(text=u&#39;取消&#39;)
        d.watcher(&#39;confirm&#39;).when(text=u&#39;确认&#39;).when(textContains=u&#39;应用程序许可&#39;).click(text=u&#39;确认&#39;)
        d.watcher(&#39;agree&#39;).when(text=u&#39;同意并使用&#39;).click(text=u&#39;同意并使用&#39;)
        d.watcher(&#39;weishiuninstall&#39;).when(textContains=u&#39;暂不处理&#39;).click(textContains=u&#39;暂不处理&#39;)
        # d.watchers.run()
        data = 0
        util.doInThread(runwatch,d,data,t_setDaemon=True)
        #启动急救箱并退出急救箱
        cmd = &#39;adb -s %s shell am start com.qihoo.mkiller/com.qihoo.mkiller.ui.index.AppEnterActivity&#39;% device
        util.exccmd(cmd)
        time.sleep(5)
        times = 3
        while(times):
            d.press.back()
            if d(text=u&#39;确认&#39;).count:
                d(text=u&#39;确认&#39;).click()
                break
            else:
                time.sleep(1)
                times -=1

        for item in apklist:
            apkpath = item
            if not os.path.exists(apkpath):
                logger.error(&#39;%s的应用不存在，请检查&#39;%apkpath)
                continue 
            if not device:
                cmd = &#39;adb install -r &quot;%s&quot;&#39; % apkpath
            else:
                cmd = &#39;adb -s %s install -r &quot;%s&quot;&#39;%(device,apkpath)
            util.doInThread(checkcancel,d,sucapp,errapp)
            rst = util.exccmd(cmd)
    except Exception, e:
        logger.error(traceback.format_exc())
        data = 1
    data = 1
    return sucapp

def finddevices():
    rst = util.exccmd(&#39;adb devices&#39;)
    devices = re.findall(r&#39;(.*?)\s+device&#39;,rst)
    if len(devices) &gt;1:
        deviceIds = devices[1:]
        logger.info(&#39;共找到%s个手机&#39;%str(len(devices)-1))
        for i in deviceIds:            
            logger.info(&#39;ID为%s&#39;%i)
        return deviceIds
    else:
        logger.error(&#39;没有找到手机，请检查&#39;)
        return 

#needcount:需要安装的apk数量，默认为0，既安所有
#deviceids:手机的列表
#apklist:apk应用程序的列表
def doInstall(deviceids,apklist):
    count = len(deviceids)
    port_list = range(5555,5555+count)
    for i in range(len(deviceids)):
        d = Device(deviceids[i],port_list[i])
        util.doInThread(installapk,apklist,d,deviceids[i])

#结束应用
def uninstall(deviceid,packname,timeout=20):
    cmd = &#39;adb -s %s uninstall %s&#39; %(deviceid,packname) 
    ft = util.doInThread(os.system,cmd,t_setDaemon=True)
    while True:
        if ft.isFinished():
            return True
        else:
            time.sleep(1)
            timeout -= 1
            if timeout == 0:
                return False

# 需要配置好adb 环境变量
# 1.先确定有几台手机
# 2.再确定有多少个应用
# 3.先安装mkiller,启动mkiller
# 4.再安装测试的样本
# 5.检查是否有取消安装的按钮出现，出现说明测试通过，没出现说明测试失败

if __name__ == &quot;__main__&quot;:
    cleanEnv()
    logger = util.logger
    devicelist = finddevices()
    if devicelist:       
        apkpath = os.path.join(os.getcwd(),&#39;apk&#39;)
        apklist = util.listFile(apkpath)
        doInstall(devicelist,apklist) #每个手机都要安装apklist里的apk
</code></pre>
<p>util.py 线程与执行cmd脚本函数文件</p>
<pre><code class="python">#coding:gbk
import os,sys
import log
import logging
import threading
import multiprocessing
import time

logger = log.Logger(&#39;log.log&#39;,clevel = logging.DEBUG,Flevel = logging.INFO)

def exccmd(cmd):
    try:
        return os.popen(cmd).read()
    except Exception:
        return None

#遍历目录内的文件列表
def listFile(path, isDeep=True):
    _list = []
    if isDeep:
        try:
            for root, dirs, files in os.walk(path):
                for fl in files:
                    _list.append(&#39;%s\%s&#39; % (root, fl))
        except:
            pass
    else:
        for fn in glob.glob( path + os.sep + &#39;*&#39; ):
            if not os.path.isdir(fn):
                _list.append(&#39;%s&#39; % path + os.sep + fn[fn.rfind(&#39;\\&#39;)+1:])
    return _list

#线程函数
class FuncThread(threading.Thread):
    def __init__(self, func, *params, **paramMap):
        threading.Thread.__init__(self)
        self.func = func
        self.params = params
        self.paramMap = paramMap
        self.rst = None
        self.finished = False

    def run(self):
        self.rst = self.func(*self.params, **self.paramMap)
        self.finished = True

    def getResult(self):
        return self.rst

    def isFinished(self):
        return self.finished

def doInThread(func, *params, **paramMap):
    t_setDaemon = None
    if &#39;t_setDaemon&#39; in paramMap:
        t_setDaemon = paramMap[&#39;t_setDaemon&#39;]
        del paramMap[&#39;t_setDaemon&#39;]
    ft = FuncThread(func, *params, **paramMap)
    if t_setDaemon != None:
        ft.setDaemon(t_setDaemon)
    ft.start()
    return ft
</code></pre>
<p>log.py log相应的函数文件</p>
<pre><code class="python">
#coding=gbk
import logging,os
import ctypes

FOREGROUND_WHITE = 0x0007
FOREGROUND_BLUE = 0x01 # text color contains blue.
FOREGROUND_GREEN= 0x02 # text color contains green.
FOREGROUND_RED  = 0x04 # text color contains red.
FOREGROUND_YELLOW = FOREGROUND_RED | FOREGROUND_GREEN

STD_OUTPUT_HANDLE= -11
std_out_handle = ctypes.windll.kernel32.GetStdHandle(STD_OUTPUT_HANDLE)
def set_color(color, handle=std_out_handle):
    bool = ctypes.windll.kernel32.SetConsoleTextAttribute(handle, color)
    return bool

class Logger:
    def __init__(self, path,clevel = logging.DEBUG,Flevel = logging.DEBUG):
        self.logger = logging.getLogger(path)
        self.logger.setLevel(logging.DEBUG)
        fmt = logging.Formatter(&#39;[%(asctime)s] [%(levelname)s] %(message)s&#39;, &#39;%Y-%m-%d %H:%M:%S&#39;)
        #设置CMD日志
        sh = logging.StreamHandler()
        sh.setFormatter(fmt)
        sh.setLevel(clevel)
        #设置文件日志
        fh = logging.FileHandler(path)
        fh.setFormatter(fmt)
        fh.setLevel(Flevel)
        self.logger.addHandler(sh)
        self.logger.addHandler(fh)

    def debug(self,message):
        self.logger.debug(message)

    def info(self,message):
        self.logger.info(message)

    def war(self,message,color=FOREGROUND_YELLOW):
        set_color(color)
        self.logger.warn(message)
        set_color(FOREGROUND_WHITE)

    def error(self,message,color=FOREGROUND_RED):
        set_color(color)
        self.logger.error(message)
        set_color(FOREGROUND_WHITE)

    def cri(self,message):
        self.logger.critical(message)

if __name__ ==&#39;__main__&#39;:
    logyyx = Logger(&#39;yyx.log&#39;,logging.WARNING,logging.DEBUG)
    logyyx.debug(&#39;一个debug信息&#39;)
    logyyx.info(&#39;一个info信息&#39;)
    logyyx.war(&#39;一个warning信息&#39;)
    logyyx.error(&#39;一个error信息&#39;)
    logyyx.cri(&#39;一个致命critical信息&#39;)
</code></pre>
<p>这个小测试应用虽然比较简单，但是由于刚刚接触uiautomator的python封装，所以还是遇到了一些麻烦，不过还好，最终的结果是很好的解决了相应的问题，这里也算是抛砖引玉吧，这个uiautomator还有很多好玩的值得探索的地方，待以后慢慢发现~</p>

        <div class="article-footer-copyright">
            本文由 杨彦星 发表于 杨彦星的个人博客 ,采用<a href="https://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" >「署名 4.0 国际」</a>创作共享协议。<br>
            非商业转载请注明作者及出处。商业转载请联系作者本人。<br>
            本文标题为: 使用uiautomator的python封装进行android的UI测试<br>
            本文链接为：<a href="http://www.yangyanxing.com/article/how-to-use-uiautomator-with-python.html">http://www.yangyanxing.com/article/how-to-use-uiautomator-with-python.html</a><br>
        </div>
    </main>
    <footer class="post-footer">
      
      
      <div class="post-tags">
        
        
        
        
        
        
        <a class="post-tag button" href="/tags/python/" style="background: #fc6423" rel="tag"><i class="fas fa-tags"></i> python</a>
        
        
        
        <a class="post-tag button" href="/tags/android/" style="background: #a3bb54" rel="tag"><i class="fas fa-tags"></i> android</a>
        
        
        
        <a class="post-tag button" href="/tags/自动化测试/" style="background: #47aaff" rel="tag"><i class="fas fa-tags"></i> 自动化测试</a>
        
        
      </div>
      
    </footer>
  </article>
  
  
<div class="reward" id="reward">
  <p>坚持原创技术分享，您的鼓励将是我继续前进的动力！求鼓励，求支持！</p>
  <button id="reward-button" class="button" disable="enable">打赏</button>
  <div id="qr" class="qr" style="display: none;">
    
    <div id="wechat">
      <img id="wechat_qr" src="/images/wechat.jpg" alt="微信支付"/>
      <span>微信支付</span>
    </div>
    
    
    <div id="alipay">
      <img id="alipay_qr" src="/images/alicode.jpg" alt="支付宝"/>
      <span>支付宝</span>
    </div>
    
    
  </div>
</div>


  
  
  <div class="post-nav">
    
    <div class="post-nav-next post-nav-item">
      <a href="/article/1350.html" rel="next" title="使用wxPython建立一个计算文件md5的GUI工具">
        <i class="fas fa-angle-left"></i>
        <span class="nav-title">使用wxPython建立一个计算文件md5的GUI工具</span>
      </a>
    </div>
    
    
    <div class="post-nav-prev post-nav-item">
      <a href="/article/1381.html" rel="prev" title="使用jquery在一个页面中有多个form表单做数据有效性校验">
        <span class="nav-title">使用jquery在一个页面中有多个form表单做数据有效性校验</span>
        <i class="fas fa-angle-right"></i>
      </a>
    </div>
    
  </div>
  
  
</section>

          </div>
          
          
          
<aside class="sidebar" id="sidebar">
  
  <div class="search">
    <div class="form-group">
      <i class="fas fa-search"></i> <input type="text" id="search-input" name="q" results="0" placeholder="搜索" class="form-control"/>
    </div>
  </div>
  <div class="search-result-box" id="search-result"></div>
  
  
<div class="info sidebar-item" id="info">
  
  <img class="author-avatar" src="/images/1.jpg" alt="杨彦星">
  
  <p class="author-name">杨彦星</p>
  <p class="author-description"> 人一切的痛苦，本质是都是对自已的无能的愤怒</p>
  <div class="site-count">
    
    
    
  </div>
  
  <div class="rss">
    <a class="rss-link button sidebar-item" href="/atom.xml"><i class="fas fa-rss"></i> RSS</a>
  </div>
  
</div>


  <div class="sidebar-sticky">
    
    




<hr>
<div class="post-toc sidebar-item" id="toc-div">
  <p><i class="fas fa-list-ol"></i> 文章目录</p>
  <div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#准备："><span class="toc-text"><a href="#&#x51C6;&#x5907;&#xFF1A;" class="headerlink" title="&#x51C6;&#x5907;&#xFF1A;"></a>&#x51C6;&#x5907;&#xFF1A;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#确定有几台手机"><span class="toc-text"><a href="#&#x786E;&#x5B9A;&#x6709;&#x51E0;&#x53F0;&#x624B;&#x673A;" class="headerlink" title="&#x786E;&#x5B9A;&#x6709;&#x51E0;&#x53F0;&#x624B;&#x673A;"></a>&#x786E;&#x5B9A;&#x6709;&#x51E0;&#x53F0;&#x624B;&#x673A;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#uiautomator在python中的使用"><span class="toc-text"><a href="#uiautomator&#x5728;python&#x4E2D;&#x7684;&#x4F7F;&#x7528;" class="headerlink" title="uiautomator&#x5728;python&#x4E2D;&#x7684;&#x4F7F;&#x7528;"></a>uiautomator&#x5728;python&#x4E2D;&#x7684;&#x4F7F;&#x7528;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#基本的点击操作"><span class="toc-text"><a href="#&#x57FA;&#x672C;&#x7684;&#x70B9;&#x51FB;&#x64CD;&#x4F5C;" class="headerlink" title="&#x57FA;&#x672C;&#x7684;&#x70B9;&#x51FB;&#x64CD;&#x4F5C;"></a>&#x57FA;&#x672C;&#x7684;&#x70B9;&#x51FB;&#x64CD;&#x4F5C;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#watcher的使用"><span class="toc-text"><a href="#watcher&#x7684;&#x4F7F;&#x7528;" class="headerlink" title="watcher&#x7684;&#x4F7F;&#x7528;"></a>watcher&#x7684;&#x4F7F;&#x7528;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#多台手机的运行问题"><span class="toc-text"><a href="#&#x591A;&#x53F0;&#x624B;&#x673A;&#x7684;&#x8FD0;&#x884C;&#x95EE;&#x9898;" class="headerlink" title="&#x591A;&#x53F0;&#x624B;&#x673A;&#x7684;&#x8FD0;&#x884C;&#x95EE;&#x9898;"></a>&#x591A;&#x53F0;&#x624B;&#x673A;&#x7684;&#x8FD0;&#x884C;&#x95EE;&#x9898;</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#最终的代码"><span class="toc-text"><a href="#&#x6700;&#x7EC8;&#x7684;&#x4EE3;&#x7801;" class="headerlink" title="&#x6700;&#x7EC8;&#x7684;&#x4EE3;&#x7801;"></a>&#x6700;&#x7EC8;&#x7684;&#x4EE3;&#x7801;</span></a></li></ol></div>
</div>



    
    
    
<hr>
<div class="social-link sidebar-item">
  <p><i class="far fa-address-card"></i> 社交链接</p>
  <ul>
    
    <li><i class="fab fa-github"></i> <a href="https://github.com/kevinkelin" target="_blank">GitHub</a></li>
    
    <li><i class="fab fa-weibo"></i> <a href="https://weibo.com/kevinkelin" target="_blank">Weibo</a></li>
    
    <li><i class="far fa-envelope"></i> <a href="mailto:admin@yangyanxing.com" target="_blank">Email</a></li>
    
    <li><i class="fab fa-facebook"></i> <a href="https://www.facebook.com/yangyanxing" target="_blank">Facebook</a></li>
    
    <li><i class="fab fa-twitter"></i> <a href="https://www.twitter.com/yangyanxing" target="_blank">Twitter</a></li>
    
  </ul>
</div>


    
    
    
<hr>
<div class="blogroll sidebar-item">
  <p><i class="fas fa-link"></i> 友情链接</p>
  <ul>
    
    <li><a href="http://www.liaoxuefeng.com/" target="_blank">廖雪峰</a></li>
    
    <li><a href="http://blog.csdn.net/itfootball" target="_blank">D.Q的专栏</a></li>
    
    <li><a href="http://opentest.360.cn/" target="_blank">360开测</a></li>
    
    <li><a href="https://testerhome.com/" target="_blank">TesterHome</a></li>
    
    <li><a href="http://www.androiddevtools.cn/" target="_blank">AndroidDev</a></li>
    
    <li><a href="http://blog.csdn.net/guolin_blog" target="_blank">郭霖的专栏</a></li>
    
    <li><a href="http://coolshell.cn/" target="_blank">酷壳</a></li>
    
    <li><a href="http://www.ruanyifeng.com/blog/archives.html" target="_blank">阮一峰</a></li>
    
    <li><a href="http://stormzhang.com/" target="_blank">stormzhang博客</a></li>
    
    <li><a href="https://imququ.com/" target="_blank">Jerry Qu</a></li>
    
  </ul>
</div>


    
  </div>
</aside>


          
        </div>
      </div>
    </main>
    
<footer id="footer" class="footer">
  <div class="container">
    <div class="back-to-top">
      <a id="back-to-top"><i class="fas fa-angle-double-up"></i></a>
    </div>
    <div class="footer-container">
      <div class="footer-left">
        <div class="copyright">
          <span class="author">杨彦星</span>
          <span class="year"><i class="far fa-copyright"></i> 2010 - 2018</span>
          
          <span class="creative-commons"><i class="fab fa-creative-commons"></i> <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">BY-NC-SA 4.0</a></span>
          
          <br>
          <span>
          <a href="http://www.miitbeian.gov.cn/" target="_blank" class="text-muted">京ICP备18004468号</a>
          <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1257423854'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1257423854%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script></span>

            <script>
				(function(){
				    var bp = document.createElement('script');
				    var curProtocol = window.location.protocol.split(':')[0];
				    if (curProtocol === 'https'){
				   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
				  }
				  else{
				  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
				  }
				    var s = document.getElementsByTagName("script")[0];
				    s.parentNode.insertBefore(bp, s);
				})();
			</script>
        </div>
        
      </div>
      <div class="footer-right">
        <div class="custom-info">
          
          托管于 <i class="fab fa-github-alt"></i> <a href="https://coding.net/pages" target="_blank">Hosted by CODING Pages</a>
          
        </div>
        <div class="powered-by">
          由 <a href="https://hexo.io/" target="_blank">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/AlynxZhou/hexo-theme-aria/" target="_blank">ARIA</a>
        </div>
      </div>
    </div>
  </div>
  
</footer>


  </body>
</html>
